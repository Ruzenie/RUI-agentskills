# UI Fullflow Quality Gates

该契约用于把《AI_UI_Skill_Design_Document.md》和《AI前端开发技能规范.md》中的质量要求落地为统一门禁。

## 五阶段生命周期门禁

1. Phase 1: 需求分析与设计探索
- 必填输入：brief、framework、project_type
- 输出：需求摘要、技术栈候选、设计方向候选
- 样式改动任务额外必填：style_target（明确改动区域）
- 需求建议：八维覆盖分 `completeness_score >= 70`

2. Phase 2: 架构规划与组件设计
- 输出：目录结构建议、组件层级、抽离策略
- 关键门禁：组件边界清晰、职责单一

3. Phase 3: 代码生成与实现
- 输出：可运行代码、依赖清单
- 关键门禁：类型安全、可访问性基线、样式一致性
- 若涉及图标：需有 icon manifest/spec，且风格尺寸命名一致

4. Phase 4: 自我审查与重构
- 触发重构条件：
  - 单文件 > 200 行
  - 渲染逻辑 > 30 行
  - 相同模式重复 >= 3
  - Props 穿透 > 3 层

5. Phase 5: 验收与交付
- 输出：验收结论、问题清单、交付建议
- 发布建议依据：功能/视觉/代码/性能/安全与兼容

## 样式改动边界门禁（强制）

1. 前置锁定
- 必须产出 `style.scope.lock.json`，且 `scope_locked=true`。
- 必须明确 `style_target`（例如：登录页头部导航、Dashboard 卡片区）。

2. 文件边界
- 应提供允许改动文件清单（`allowed_files`）。
- 提交前需确认变更仅发生在目标样式文件或目标组件样式段。

3. 越界阻断
- 任一以下行为判定为阻断：
  - 修改目标区域外的页面/组件
  - 修改业务逻辑、接口、路由、状态结构
  - 引入与样式无关的依赖变更

## 图标系统门禁（按需）

1. 触发条件
- brief 或需求中出现 icon/svg/canvas/图标/可视化关键词。

2. 必要产物
- `icon.manifest.json`
- `icon.spec.md`
- `icon.sprite.svg`（SVG 路线）或 `canvas.icon.demo.js`（Canvas 路线）

3. 一致性检查
- 尺寸层级（16/20/24）一致
- 描边与端点规则一致
- 命名规则一致（`icon-<category>-<name>`）

## 验收维度矩阵

1. 功能验收
- 核心功能、异常流程、状态管理、路由/导航

2. 视觉验收
- 布局层级、间距节奏、排版清晰度、色彩对比、交互反馈

3. 代码验收
- 命名规范、组件化、无 `any`、低重复、可维护性

4. 性能验收
- 首屏性能、重渲染控制、资源优化、长列表策略

5. 安全与兼容验收
- 输入转义、敏感信息暴露检查、主流浏览器兼容性

## 自评权重模型

- 完整性：30%
- 美学：25%
- 可维护性：25%
- 性能：20%

## 量化门槛（mimoskills 对齐）

- 审美评分门槛：`>= 4.0 / 5.0`
- 组件复用率门槛：`>= 40%`
- 平均圈复杂度门槛：`<= 10`
- TS 类型覆盖门槛：`>= 90%`
- 色彩对比度门槛：`>= 4.5:1`（WCAG AA）

## 分档规则

- 90-100：优秀（可推广）
- 80-89：良好（可交付）
- 70-79：合格（建议优化后交付）
- 60-69：待改进（必须优化后交付）
- 0-59：不合格（需重做）
